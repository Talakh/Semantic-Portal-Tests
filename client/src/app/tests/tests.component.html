<div *ngIf="attempt == null" class="container" style="padding-top: 10%;">
  <div class="row justify-content-center">
    <mat-form-field appearance="fill" class="col-md-3">
      <mat-label>Select the subject</mat-label>
      <mat-select [(ngModel)]="branch">
        <mat-option *ngFor="let b of branches" [value]="b">{{b.caption}}</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="fill" class="col-md-3 col-md-offset-5">
      <mat-label>Select the difficult level</mat-label>
      <mat-select [(ngModel)]="difficultLevel">
        <mat-option value="LOW">Low</mat-option>
        <mat-option value="MEDIUM">Medium</mat-option>
        <mat-option value="HIGH">High</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <div style="padding-top: 10px;" class="row justify-content-center">
    <button mat-raised-button (click)="createTests()">Create</button>
  </div>
</div>
<div *ngIf="attempt != null && attempt.tests.length > 0 && attemptResult == null" class="container pt-3">

  <mat-progress-bar class="mb-3" mode="determinate" [value]="currentTestIndex / attempt.tests.length * 100"></mat-progress-bar>

    <h2 class="row justify-content-center question mb-5">
      <span>{{currentTestIndex + 1}}. {{normalizeText(currentTest.question)}}</span>
      <code *ngIf="currentTest.codeInQuestion" class="code justify-content-center ">{{currentTest.codeInQuestion}}</code>
    </h2>


    <div *ngIf="currentTest.type == testTypes.ONE_CORRECT_ANSWER">
      <mat-radio-group class="row justify-content-center" [class.blocked]="!needCheck">
        <mat-radio-button *ngFor="let one of currentTest.answers"
                          name="defaultExampleRadios"
                          (click)="changeAnswer(one.id);"
                          value="{{one.id}}"
                          class="d-block">
          <div class="answer text-left"
               [class.wrong-answer] = '(!needCheck && !isCorrect && one.id == answerId)'
               [class.correct-answer] = '(!needCheck && one.id == correctAnswerId)'>
            {{normalizeText(one.answer)}}
          </div>
        </mat-radio-button>
      </mat-radio-group>
    </div>

    <div *ngIf="currentTest.type == testTypes.SEVERAL_CORRECT_ANSWER">
      <div class="row justify-content-center" *ngFor="let several of currentTest.answers" [class.blocked]="!needCheck">
        <mat-checkbox
          (click)="addOrRemoveAnswer(several.id)"
          value="{{several.id}}">
          <div class="answer text-left"
               [class.wrong-answer] = '(!needCheck && !correctAnswerIds.includes(several.id) && answerIds.includes(several.id))'
               [class.correct-answer] = '(!needCheck && correctAnswerIds.includes(several.id))'>
            {{normalizeText(several.answer)}}
          </div>
        </mat-checkbox>
      </div>
    </div>
    <div *ngIf="currentTest.type == testTypes.MATCH">
      <div class="row justify-content-center">
        <ol>
          <li class="question row" *ngFor="let q of currentTest.matchQuestion">
            <div style="width: 600px">{{normalizeText(q.question)}}</div>
            <mat-form-field appearance="fill" class="col-md-3">
              <mat-label>Select the subject</mat-label>
              <mat-select (valueChange)="answerMap[q.id] = $event">
                <mat-option *ngFor="let a of currentTest.answers"
                            [value]="a.id">
                  {{normalizeText(a.answer)}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </li>
        </ol>
      </div>
    </div>


  <div class="col text-center" *ngIf="needCheck">
    <button mat-raised-button class="btn-custom mt-4" color="primary" (click)="checkAnswer(currentTest.id)">Check</button>
  </div>
  <div class="col text-center" *ngIf="!needCheck && currentTestIndex < attempt.tests.length - 1">
    <button mat-raised-button class="btn-custom mt-4" (click)="nextTest()">Next</button>
  </div>
  <div class="col text-center" *ngIf="!needCheck && currentTestIndex == attempt.tests.length - 1">
    <button mat-raised-button class="btn-custom mt-4" (click)="finish()">Finish</button>
  </div>
</div>
<div *ngIf="attemptResult != null" class="container">
  <h1 class="row justify-content-center">
    Your result: <span
    [ngStyle]="{'color' : attemptResult.isPassed ? 'green' : 'red'}">
      {{attemptResult.correctAnswersCount}}/{{attemptResult.questionsCount}} points ({{attemptResult.percent}}%)
    </span>
  </h1>
  <h2 class="row justify-content-center">
    Status:
    <span *ngIf="attemptResult.isPassed" style="color: green">PASSED</span>
    <span *ngIf="!attemptResult.isPassed" style="color: red">FAILED</span>
  </h2>
  <br>
  <h2 *ngIf="attemptResult.isPassed" class="row justify-content-center">Congratulations, you've successfully passed the
    test.</h2>
  <h2 *ngIf="!attemptResult.isPassed" class="row justify-content-center">You’re almost there… Try it again!</h2>
  <br>
  <div *ngIf="attemptResult.topicsToRepeat.length > 0">
    <h3 class="row justify-content-center">Topics to learn</h3>
    <div class="row justify-content-center">
      <ol>
        <li *ngFor="let topic of attemptResult.topicsToRepeat">
          <a target="_blank" href='http://semantic-portal.net/{{topic.domainUrl}}'>{{topic.domainName}}</a>
        </li>
      </ol>
    </div>
  </div>
</div>
